# Tasks: Passwordless Authentication & PostgreSQL Migration

## 1. Backend: Database Migration to PostgreSQL
- [ ] 1.1 Добавить DATABASE_URL в Render environment variables
- [x] 1.2 Проверить что psycopg2-binary есть в requirements.txt
- [ ] 1.3 Задеплоить бэкенд и проверить подключение к PostgreSQL через логи
- [ ] 1.4 Проверить что таблицы создались автоматически

## 2. Backend: Update User Model for Passwordless Auth
- [x] 2.1 Изменить поле password на nullable в модели User
- [ ] 2.2 Создать миграцию для изменения схемы (если используется Alembic)
- [ ] 2.3 Проверить что модель корректно работает с PostgreSQL

## 3. Backend: Update Auth Schemas
- [x] 3.1 Обновить RegisterSchema - убрать password, оставить phone, email, full_name, role
- [x] 3.2 Создать новый LoginSchema с одним полем phone
- [x] 3.3 Добавить валидацию формата телефона (+998XXXXXXXXX)
- [x] 3.4 Добавить очистку телефона от пробелов и дефисов

## 4. Backend: Update Auth Endpoints
- [x] 4.1 Обновить POST /auth/register - убрать логику с паролем
- [x] 4.2 Обновить POST /auth/login - убрать проверку пароля, только поиск по телефону
- [x] 4.3 Обновить сообщения об ошибках на русском
- [ ] 4.4 Протестировать endpoints через Swagger UI

## 5. Backend: Testing
- [ ] 5.1 Написать unit test для регистрации без пароля
- [ ] 5.2 Написать unit test для входа только по телефону
- [ ] 5.3 Написать unit test для проверки уникальности телефона
- [ ] 5.4 Написать unit test для валидации формата телефона

## 6. Backend: Deployment
- [ ] 6.1 Закоммитить все изменения в Git
- [ ] 6.2 Запушить в GitHub
- [ ] 6.3 Дождаться автоматического деплоя на Render
- [ ] 6.4 Проверить логи деплоя на наличие ошибок
- [ ] 6.5 Протестировать API через Swagger: https://odontohub.onrender.com/docs

## 7. Frontend: Update TypeScript Interfaces
- [x] 7.1 Обновить LoginData interface - убрать password
- [x] 7.2 Обновить RegisterData interface - убрать password
- [ ] 7.3 Проверить что нет других мест где используется password

## 8. Frontend: Update API Layer
- [x] 8.1 Обновить useLogin hook - отправлять только phone
- [x] 8.2 Обновить useRegister hook - убрать password из данных
- [x] 8.3 Убрать OAuth2 form-data формат, использовать обычный JSON

## 9. Frontend: Update Login Page
- [x] 9.1 Убрать поле пароля из формы
- [x] 9.2 Убрать кнопку показа/скрытия пароля
- [x] 9.3 Изменить label на "Номер телефона"
- [x] 9.4 Обновить placeholder на "+998 90 123 45 67"
- [x] 9.5 Обновить валидацию - только проверка телефона
- [x] 9.6 Обновить текст кнопки и заголовок

## 10. Frontend: Update Register Page
- [x] 10.1 Убрать поле пароля из формы регистрации
- [x] 10.2 Убрать поле подтверждения пароля
- [x] 10.3 Обновить валидацию формы
- [x] 10.4 Проверить что все остальные поля работают корректно

## 11. Frontend: Testing
- [ ] 11.1 Протестировать регистрацию с валидным телефоном
- [ ] 11.2 Протестировать регистрацию с невалидным телефоном
- [ ] 11.3 Протестировать вход с существующим телефоном
- [ ] 11.4 Протестировать вход с несуществующим телефоном
- [ ] 11.5 Проверить что токен сохраняется в localStorage
- [ ] 11.6 Проверить редирект после успешного входа

## 12. Frontend: Deployment
- [ ] 12.1 Закоммитить изменения в Git
- [ ] 12.2 Собрать production build: npm run build
- [ ] 12.3 Задеплоить на Netlify
- [ ] 12.4 Проверить что всё работает на production

## 13. Integration Testing
- [ ] 13.1 Зарегистрировать нового пользователя на production
- [ ] 13.2 Выйти и войти снова с тем же номером
- [ ] 13.3 Сделать редеплой бэкенда на Render
- [ ] 13.4 Проверить что пользователь остался в базе (вход работает)
- [ ] 13.5 Создать несколько тестовых пользователей (стоматологов)

## 14. Documentation & Cleanup
- [ ] 14.1 Обновить README с новыми инструкциями по входу
- [ ] 14.2 Удалить неиспользуемый код связанный с паролями
- [ ] 14.3 Обновить комментарии в коде
- [ ] 14.4 Создать инструкцию для тестировщиков

## Notes
- Начинать с бэкенда (задачи 1-6)
- Потом фронтенд (задачи 7-12)
- В конце интеграционное тестирование (задача 13)
- Локальная разработка продолжает использовать SQLite
- Production использует PostgreSQL автоматически через DATABASE_URL
